var promoBtn = $("#promoBtn");
var promoStatus = $("#promoStatus");

function getOffersByPromocode(promoCode, callback) {
    if (!promoCode || promoCode.trim() == "") {
        promoStatus.text("Please enter a promoCode");
        return;
    }
    var api_key = "yLZ4cKcEgPsnZn1s9b9FHhR9cUbO4AdM0z3fvmKQjiw=";
    promoCode = promoCode.trim();
    promoBtn.prop("disabled", true);
    promoStatus.text("applying promo code");
    $.ajax({
        method: "GET",
        url: "https://b2capi.thyrocare.com/APIs/master.svc/" + api_key + "/" + promoCode + "/PromoCodeDetails",
        contentType: "application/json",
        success: function (data) {
            if (data.discount) {
                localStorage.setItem("promocodeDiscount", JSON.stringify(data.discount))
            }
            callback(data)
        },
        error: function (err) {
            callback({
                error: err
            })
        }
    })
}

function showOffersFromPromocodeData(promocodeData) {
    promoBtn.prop("disabled", false);
    if (promocodeData.error) {
        promoStatus.text("error in getting offers");
        return;
    }
    if (!promocodeData || !promocodeData.OFFER || promocodeData.OFFER.length < 1) {
        promoStatus.text("No offers available yet");
        return;
    }
    localStorage.setItem("promocodeData", JSON.stringify(promocodeData));
    var offerDivs = "";
    promocodeData.OFFER.map(function (offer, index) {
        var offerDiv = "";
        var stringifiedJSON = JSON.stringify(offer);
        offerDiv += '<div class="col-md-4 related-test-inner ">' + '<div class="related-test1  ">' + '<div class="percentage-icon">%</div> ' + '<p style="margin-top: 10px;color:#c22031" class="packageNames">' + offer.name + "</p></a> " + "<h6>" + offer.test_count + " Tests</h6> " + '<h5 style=" font-size: 1.3em; color: #c22031; ">' + '<i class="fa fa-inr" style="font-size:20px;color:#000">' + "</i> " + (offer.rate.offer_rate == 0 ? offer.rate.pay_amt ? offer.rate.pay_amt : 0 : offer.rate.offer_rate) + " </h5>" + '<form action="" class="compare-form" onclick="setCompareData(event, this, true)"> ' + '<span class="hide">' + stringifiedJSON + "</span>\t " + "<br> " + "</form> " + '<div class="col-sm-12 margin-test"> ' + '<div class="row related-test-inner1"> ' + '<div class="col-md-6 cart-test" onclick="addOrBuyAction(event, this)">' + '<span class="hide">' + stringifiedJSON + " </span>" + '<a href="javascript:void(0)">Add to Cart</a>' + "</div>" + '<div onclick="addOrBuyAction(event, this, true)" class="col-md-6 cart-test1">' + '<span class="hide"> ' + stringifiedJSON + "</span>" + '<a href="javascript:void(0)">Book</a>' + "</div>" + "</div>" + "</div>" + "</div>" + "</div>";
        offerDivs += offerDiv;
    });
    $("#thyrocareOffers-container").prepend(offerDivs);
    promoStatus.text("offers fetched successfully");
    $("#packageType").val("all");
    filterByType();
}